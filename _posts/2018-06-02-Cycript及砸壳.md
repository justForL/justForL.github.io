---
title: CycriptåŠç ¸å£³

layout: post

tags: é€†å‘

---

## rootç™»å½•æ‰‹æœº
è®¾å¤‡:iphone 6p

ç‰ˆæœ¬:10.2.1

çŠ¶æ€:è¶Šç‹±

åœ¨ä½¿ç”¨sshç™»å½•çš„æ—¶å€™,ä¸èƒ½æˆåŠŸ,å¤šæ¬¡æŸ¥è¯å,è¯´æ­¤æ¬¡è¶Šç‹±æ˜¯å¸¦æœ‰openssh,å¦‚æœè‡ªå·±æ‰‹åŠ¨openssh,åè€Œä¼šå¯¼è‡´ä¸èƒ½sshç™»å½•
![](https://ws4.sinaimg.cn/large/006tKfTcly1frwlikfnyfj30q003st9f.jpg)
æ‰€ä»¥ä½¿ç”¨usbæ¨¡å¼,ä»¥ç«¯å£è½¬å‘çš„æ–¹å¼è¿›è¡Œç™»å½•

* æ‰“å¼€ppåŠ©æ‰‹,æ‰¾åˆ°å·¥å…·ä¸‹çš„,æ‰“å¼€sshé€šé“
![](https://ws1.sinaimg.cn/large/006tKfTcly1frwlkf6wxtj31ke0xgtfu.jpg)
* æ ¹æ®æç¤ºè¿›è¡Œç™»å½•
![](https://ws2.sinaimg.cn/large/006tKfTcly1frwlldl0jcj30xq0nste5.jpg)

![](https://ws2.sinaimg.cn/large/006tKfTcly1frwlm64dpuj30va03cmxl.jpg)

> è¿™æ ·åŒæ ·å¯ä»¥ä»¥rootæƒé™è¿›å…¥,ä½†æ˜¯åœ¨ç½‘ç»œä¸ŠæŸ¥è¯¢è¯´,æŠŠè®¾å¤‡æ¢å¤æœªè¶Šç‹±çŠ¶æ€ä¸‹,é‡æ–°è¶Šç‹±,ä¸å†å®‰è£…opensshå°±å¯ä»¥ç›´æ¥sshç™»å½•äº†,æ‡’å¾—æŠ˜è…¾äº†,å°±æ²¡æœ‰è¯•éªŒğŸ˜†

## å·¥å…·å®‰è£…
> è¶Šç‹±åæ‰‹æœºå®‰è£…

* adv-cmds
* vi improved
* MTerminal

## scpé—®é¢˜è§£å†³
æœ¬æ¥æ­£é«˜é«˜å…´å…´çš„,å‡†å¤‡è¿›è¡Œä¸‹ä¸€æ­¥æ“ä½œ,å¯æ˜¯éœ€è¦å°†æŸäº›æ–‡ä»¶ä¼ è¾“åˆ°æ‰‹æœºä¸Šçš„æ—¶å€™,å‘ç°,å¹¶ä¸èƒ½åƒç½‘ç»œä¸Šçš„æ–‡ç« ä¸€æ ·è®²æ–‡ä»¶ç”¨scpçš„å‘½ä»¤æ‹·è´åˆ°æ‰‹æœºä¸Š,ä¸€è„¸æ‡µé€¼,äºæ˜¯å„ç§æŸ¥æ‰¾ç­”æ¡ˆ
![](https://ws3.sinaimg.cn/large/006tKfTcly1frwluui3rqj30jr0hfah1.jpg)

[
iOS10 ç»è¿‡yaluè¶Šç‹±åæ— æ³•sshç™»å½•å’Œæ— æ³•scpæ‹·è´é—®é¢˜](https://blog.csdn.net/u011661836/article/details/72974585)

æ ¹æ®æ–‡ç« ä¸­çš„ä¿®å¤scpæ–¹æ³•åœ¨æ‰‹æœºä¸­ç«¯ä¸­æ— æ³•æ‰§è¡Œldid -S scp,ç«Ÿç„¶æŠ¥é”™
æŸæ‰‹æ— ç­–,æ–‡ç« ä¸­ä¹Ÿè¯´åˆ°æ˜¯æ‰‹æœºå†…æ²¡æœ‰scpå¯¼è‡´æ— æ³•ä½¿ç”¨scp,é‚£æˆ‘ä»¬è‡ªå·±æŠŠscpä¸‹è½½åˆ°ç”µè„‘ä¸­,æ”¾åˆ°æ‰‹æœºä¸­ç§»åŠ¨åˆ°å¯¹åº”ç›®å½•ä¸­èƒ½ä¸èƒ½è¿è¡Œå‘¢?

* ä¸‹è½½scpåˆ°ç”µè„‘ä¸­å¹¶æ”¹åä¸ºscp[ scp](https://bbs-att-qcloud.weiphone.net/2017/01/29/13139747_scp)
* åœ¨ç»ˆç«¯ä¸­ä¸ºå®ƒææƒ 

	```c
	$ chmod 777 scp
	```
åˆ©ç”¨ifunboxä¼ è¾“åˆ°æ‰‹æœºä¸­(ç”±äºåœ¨ios10ä¸‹çš„æ–‡ä»¶ç³»ç»ŸæŸ¥çœ‹æ’ä»¶å®‰è£…ä¸ä¸Š,æ‰€æœ‰åªèƒ½çœ‹åˆ°mediaæ–‡ä»¶å¤¹ä¸‹çš„å†…å®¹o(â•¥ï¹â•¥)o)
![](https://ws4.sinaimg.cn/large/006tKfTcly1frwm6qdic5j31kw12ak5c.jpg)
* ç™»å½•æ‰‹æœº,è¿›å…¥åˆ°Mediaç›®å½•ä¸‹è¿›è¡Œæ‹·è´

	```c
	$ cd /User/Media
	```

	```c
	mv scp /usr/bin/scp
	```
* åœ¨æ‰‹æœºç»ˆç«¯æ‰§è¡Œldid -S scp
* é‡å¯springBoard

	```c
	$ killall SpringBoard
	```
* ç„¶åå°±å¯ä»¥ä½¿ç”¨scpæ‹·è´å‘½ä»¤ ğŸ˜†

> æ‹·è´å‘½ä»¤å¦‚ä¸‹,æ–‡ä»¶æ‹·è´æˆåŠŸäº†,ä½†ä¸çŸ¥ä¸ºå•¥å…å¯†ç™»å½•æ²¡æˆåŠŸ,ğŸ¤¦â€â™€ï¸ç­‰è§£å†³äº†å†å›æ¥æ›´æ–°æ–¹æ³•

```c
$ scp -P 2222 /Users/james/.ssh/id_rsa.pub root@localhost:/var/root/.ssh
```
## cyè„šæœ¬ç¼–å†™ä»¥åŠåº”ç”¨
è¿æ¥æ‰‹æœºå,è¿›è¡Œcycriptè°ƒè¯•appğŸ˜,é¦–å…ˆå…ˆæ‰¾åˆ°æˆ‘ä»¬è¦è°ƒè¯•çš„app

```c
$ ps -A WeChat
```
![](https://ws3.sinaimg.cn/large/006tKfTcly1frwmy0duq6j31ei042t9t.jpg)
å…¶ä¸­,1946å°±æ˜¯å¾®ä¿¡çš„è¿›ç¨‹å·,æˆ‘ä»¬ä¾æ®è¿›ç¨‹å·æ¥ä¾é™„åˆ°å¾®ä¿¡çš„è¿›ç¨‹ä¸Š,è¿›è¡Œè°ƒè¯•

```c
$ cycript -p 1946
```
![](https://ws1.sinaimg.cn/large/006tKfTcly1frwmzywbhcj30r002gwel.jpg)
æˆåŠŸè¿›å…¥åˆ°cycriptè°ƒè¯•,æ¥ä¸‹æ¥æˆ‘ä»¬æ¥è¯•éªŒä¸€ä¸‹
![](https://ws3.sinaimg.cn/large/006tKfTcly1frwn0qik46j30og03w0t5.jpg)

åœ¨è°ƒè¯•è¿‡ç¨‹ä¸­ç»å¸¸ä¼šä½¿ç”¨keyWindow,rootViewController,æŸ¥æ‰¾å½“å‰æ§åˆ¶å™¨,bundleIdè¿™äº›å¸¸ç”¨æ“ä½œ,å¯æ˜¯æ¯æ¬¡æ€æ‰è¿›ç¨‹,å°±éœ€è¦é‡æ–°å®šä¹‰å˜é‡å»æ¥æ”¶è¿™äº›å€¼,æˆ‘ä»¬é€šè¿‡å¼•å…¥çš„æ–¹å¼,å°†æˆ‘ä»¬æå‰å®šä¹‰å¥½çš„å˜é‡æˆ–è€…æ–¹æ³•å¼•å…¥è¿›æ¥,å°±ä¼šå¢åŠ æˆ‘ä»¬çš„å¼€å‘æ•ˆç‡ğŸ˜†

> æ‰“å°å½“å‰æ§ä»¶å±‚çº§å…³ç³»
```c
$ UIApp.keyWindow .recursiveDescription() .toString ()
```

* åœ¨sublimeä¸­åˆ›å»ºcyæ–‡ä»¶

```c

LJBundleId = [NSBundle mainBundle].bundleIdentifier;

LJAppVersion = [[[NSBundle mainBundle] infoDictionary] objectForKey:@"CFBundleShortVersionString"];

LJAppName = [[[NSBundle mainBundle] infoDictionary] objectForKey:@"CFBundleDisplayName"];

LJRootVc = function() {
    // return UIApp.keyWindow .rootViewController;
    return UIApp.keyWindow .rootViewController;
};

LJKeyWindow = function() {
    return UIApp.keyWindow
}

LJGetCurrentVcFromRootVc = function(rootVc) {
    var currentVc ;
    if ([rootVc presentedViewController]) {
        rootVc = [rootVc presentedViewController];
    }
    if ([rootVc isKindOfClass: [UITabBarController class]]) {
        currentVc = LJGetCurrentVcFromRootVc(rootVc.selectedViewController);
    }
    else if([rootVc isKindOfClass:[UINavigationController class]]) {
        currentVc = LJGetCurrentVcFromRootVc(rootVc.visibleViewController);
    }
    else{
        currentVc = rootVc;
    }
    return currentVc;
}

LJCurrentVc = function(){
    return LJGetCurrentVcFromRootVc(LJRootVc());
}

```

* å°†æ–‡ä»¶æ‹·è´åˆ°æ‰‹æœºä¸Š
```c
$ scp -P 2222  /Users/james/Desktop/james.cy root@localhost:/usr/lib/cycript0.9/top/bonjourjames/
```
![](https://ws1.sinaimg.cn/large/006tKfTcly1frxukddrvyj31kw02xmy3.jpg)

* åœ¨æ‰‹æœºä¸Šåˆ©ç”¨cycriptä¾é™„åˆ°å¾®ä¿¡ä¸­,å¹¶å¼•ç”¨æˆ‘ä»¬åˆšæ‰ä¸Šä¼ çš„cyæ–‡ä»¶
![](https://ws3.sinaimg.cn/large/006tKfTcly1frxulxi1gaj30me05awf1.jpg)

* ç°åœ¨å°±å¯ä»¥ç›´æ¥è°ƒç”¨æˆ‘ä»¬çš„å‡½æ•°äº†,å¹¶ä¸ç”¨æ¯æ¬¡éƒ½é‡æ–°å®šä¹‰å¸¸ç”¨çš„å‡½æ•°å•¦ğŸ˜†

## ç ¸å£³
### åŠ¨æ€ dumpdecrypted 
dumpdecrypted æ˜¯ä¸ªå‡ºè‰²çš„appè„±å£³å¼€æºå·¥å…·ï¼Œå®ƒçš„åŸç†æ˜¯ï¼šå°†åº”ç”¨ç¨‹åºè¿è¡Œèµ·æ¥ï¼ˆiOSç³»ç»Ÿä¼šå…ˆè§£å¯†ç¨‹åºå†å¯åŠ¨ï¼‰ï¼Œç„¶åå°†å†…å­˜ä¸­çš„è§£å¯†ç»“æœdumpå†™å…¥æ–‡ä»¶ä¸­ï¼Œå¾—åˆ°ä¸€ä¸ªæ–°çš„å¯æ‰§è¡Œç¨‹åºã€‚

* å°†dumpdecryptedä¸‹è½½åˆ°æœ¬æœº[dumpdecrypted](https://github.com/stefanesser/dumpdecrypted/archive/master.zip)

* è¿›å…¥åˆ°ä¸‹è½½ç›®å½•ä¸­,æ‰“å¼€ç»ˆç«¯æ‰§è¡Œmakeæ“ä½œ
	![](https://ws2.sinaimg.cn/large/006tKfTcly1frz2z4zr2vj30be0l0t99.jpg)

* å°†dumpdecryptedæ‹·è´åˆ°æ‰‹æœºä¸­

```c
$ scp -P 2222 dumpdecrypted.dylib root@localhost:/User
```
* æŸ¥çœ‹è¿›ç¨‹å·ä»¥åŠåº”ç”¨è·¯å¾„
	```c
	ps -A | grep XXXX
	``` 	
	![](https://ws2.sinaimg.cn/large/006tKfTcly1frz3lklmmnj312i01cq36.jpg)
	
* ä¾é™„åˆ°å¾…ç ¸å£³çš„åº”ç”¨ä¸Š,æ‰¾åˆ°Documentsè·¯å¾„

	* åˆ©ç”¨NSFileManageræ‰¾åˆ°documentsè·¯å¾„
	```c
	$ [[NSFileManager defaultManager] URLsForDirectory:NSDocumentDirectory inDomains:NSUserDomainMask][0]
	```
	![](https://ws3.sinaimg.cn/large/006tKfTcly1frz3e9o4djj316o046dgr.jpg)
	* å°†dumpdecrypted.dylibæ‹·è´è¿›Documentsä¸­
	![](https://ws1.sinaimg.cn/large/006tKfTcly1frz3h954j6j31co032wft.jpg)
	* å¼€å§‹ç ¸å£³
	```c
	DYLD_INSERT_LIBRARIES=dumpdecrypted.dylib /var/containers/Bundle/Application/69496E78-D384-485E-A2B2-39A9ED975ADB/xxx.app/xxx
	```
	
> æ­¤æ—¶å‡ºç°äº†ä¸€ä¸ªé—®é¢˜,å¯¼è‡´è¿›è¡Œä¸ä¸‹å»äº†,ä»”ç»†è¯»ä¸€è¯»è‹±æ–‡è¯´æ˜,åŸæ¥æ˜¯ç¼ºå°‘ç­¾å,é‚£æˆ‘ä»¬è¯•ç€ç­¾ä¸€ä¸‹åè¯•è¯•å‘¢

* æŸ¥çœ‹æœ¬æœºæ‰€æœ‰ç­¾åä¿¡æ¯
	```c
	$ security find-identity -v -p codesigning
	```
* é€‰æ‹©è¯ä¹¦ç­¾åé‡æ–°ç­¾å
	```c
	codesign --force --verify --verbose --sign "iPhone 	Developer: xxx xxxx (xxxxxxxxxx)" 		dumpdecrypted.dylib
	```	
* æ‹·è´åˆ°Documentsä¸‹é‡æ–°è¿è¡Œç ¸å£³å‘½ä»¤,æˆåŠŸ
	![](https://ws1.sinaimg.cn/large/006tKfTcly1frz44pga1wj31kw0idjw2.jpg)
* åˆ©ç”¨scpåå‘æ‹·è´å›æ¡Œé¢xxx.decrypted

### é™æ€

