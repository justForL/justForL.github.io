---
title: 重签名

layout: post

tags: 汇编

---

## 还原app签名过程

在日常开发中,我们最离不开的就是苹果的签名证书,推送需要用到,上架需要用到,真机调试.....一直以来就是机械化的操作,从证书助手导出,上传developer,配置证书,下载证书....没想过为什么,从开始学习逆向开始,扎实了很多原来没有深了解的知识😆,签名过程如下图:
![](https://ws2.sinaimg.cn/large/006tKfTcly1fr3oypli2wj315a166diz.jpg)
<center>签名过程</center>

接下来我们仔细的来记录一下这个过程:

> 由于iphone的软硬件都是苹果自己的,在iphone出厂的时候就把公钥放到了苹果手机内部,私钥存放在苹果的服务器中,这是前置条件😆

* 在我们的mac电脑上生成私钥,根据私钥算出公钥,复习下命令
	* $ openssl genrsa -out privateKey.pem 512
	* $ openssl rsa - in privateKey.pem -out public.pem -pubout
* 讲我们在mac上算出的公钥发送给苹果,苹果利用后台存放的私钥A对mac上传的公钥进行hash,生成签名证书再回传给我们
* 我们在开发电脑上用本地私钥,对我们的APP也就是我们的MachO文件进行签名(也就是将私钥和苹果下发的证书文件一起打包进App文件中)并传输到手机上
* 在手机中,首先先用mac本地的私钥对证书公钥进行解密,验证是苹果验证过的公钥后,用iphone本地的私钥在对证书文件中签名过的证书hash进行解密,还原公钥,当还原公钥比对一致后,说明这个app是通过签名验证的

> 苹果进行里两次签名验证,保证了安全性,可是这样又带来了另外一个问题,就是安装范围的问题,为了解决这个问题,苹果又退出了pp文件(mobileprovisionProfile),来标识这个app的安装设备,也就是我们在开发者网站上需要将调试设备添加到pp文件中,这个就不一一赘述了

## 手动签名app

## XCode自动签名app

## shell脚本自动化签名脚本
